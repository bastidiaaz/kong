(function() {
    'use strict';

    angular
        .module('angularSeedApp')
        .controller('MainController', MainController);

    /** @ngInject */
    function MainController() {
      var vm = this;
      var map = new L.Map('mapa1');

      activate();

      function activate() {
        // create the tile layer with correct attribution
        var osmUrl='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var osmAttrib='Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors';
        var osm = new L.TileLayer(osmUrl, {minZoom: 10, maxZoom: 15, attribution: osmAttrib});

        // start the map in South-East England
        map.setView(new L.LatLng(-38.73587485347638, -72.58898735046388),13);
        map.addLayer(osm);

        map.on('click', function(e) {
          console.log(e.target);
        });

        vm.valores = _.times(38, _.random.bind(0, 170));
        vm.datos = [];
        var i = 1;
        angular.forEach(vm.valores, function(valor) {
          var obj = {
            "nombre": "Sensor " + i,
            "valor": valor
          };
          vm.datos.push(obj);
          i++;
        });

        console.log(vm.datos);

        setGeoJSONLayer();
        setHeatmapLayer();
      }

      function setHeatmapLayer() {
        var heatStates = [
          [
            -72.58941650390625,
            -38.749665482332496,
            10
          ]
        ];

        var heat = L.heatLayer([
          [
            -38.710428842148914,
            -72.66752243041992,
            0.2
          ],
          [
            -38.724492231683676,
            -72.63713836669922,
            0.6
          ],
          [
            -38.735740950821786,
            -72.65190124511719,
            0.6
          ],
          [
            -38.752209093775825,
            -72.6522445678711,
            0.6
          ],
          [
            -38.754351012062315,
            -72.6606559753418,
            0.7
          ],
          [
            -38.758634655815186,
            -72.65962600708008,
            0.5
          ],
          [
            -38.76157951175738,
            -72.62615203857422,
            0.8
          ],
          [
            -38.753146190934686,
            -72.60469436645508,
            0.9
          ],
          [
            -38.74765730401542,
            -72.60005950927734,
            0.2
          ],
          [
            -38.74698789869034,
            -72.59387969970703,
            0.5
          ],
          [
            -38.749665482332496,
            -72.58941650390625,
            0.8
          ],
          [
            -38.74685401687217,
            -72.5782585144043,
            0.7
          ],
          [
            -38.7348036252108,
            -72.5592041015625,
            0.6
          ],
          [
            -38.71163438396565,
            -72.54632949829102,
            0.9
          ],
          [
            -38.702525342335896,
            -72.53070831298828,
            0.6
          ],
          [
            -38.69622870885281,
            -72.54770278930664,
            0.6
          ],
          [
            -38.7120362267202,
            -72.56589889526367,
            0.7,
          ],
          [
            -38.703998942455826,
            -72.58409500122069,
            0.8
          ],
          [
            -38.707213964583055,
            -72.59834289550781,
            0.5
          ],
          [
            -38.72288512722238,
            -72.6028060913086,
            0.9
          ],
          [
            -38.708017697527296,
            -72.62048721313477,
            0.6
          ],
          [
            -38.70493667217571,
            -72.62409210205078,
            0.7
          ],
          [
            -38.70989303926041,
            -72.62872695922852,
            0.5
          ],
          [
            -38.707481876568366,
            -72.63559341430664,
            0.2
          ],
          [
            -38.706946051593846,
            -72.6500129699707,
            0.7
          ],
          [
            -38.7054725122086,
            -72.66597747802733,
            0.6,
          ],
          [
            -38.710428842148914,
            -72.66752243041992,
            0.6
          ],
          [
            -38.71391146304092,
            -72.64469146728517,
            0.6
          ],
          [
            -38.72248334545942,
            -72.61980056762697,
            0.5
          ],
          [
            -38.716188469580736,
            -72.58186340332033,
            0.6
          ],
          [
            -38.7056064715894,
            -72.54650115966798,
            0.7
          ],
          [
            -38.73574095082179,
            -72.58375167846681,
            0.7
          ],
          [
            -38.7313220223938,
            -72.62083053588869,
            0.8
          ],
          [
            -38.74163243014555,
            -72.63679504394533,
            0.5
          ],
          [
            -38.754083275791416,
            -72.63216018676759,
            0.6
          ],
          [
            -38.732125484259186,
            -72.61739730834962,
            0.65
          ],
          [
            -38.74136464617442,
            -72.60469436645509,
            0.6
          ],
          [
            -38.72609929999976,
            -72.56349563598634,
            0.9
          ]
        ], {
          radius: 70,
          maxZoom: 13,
          max: 500,
          blur: 15
        }).addTo(map);
      }

      function setGeoJSONLayer() {
        var states = [
          {
            "type": "Feature",
            "properties": {},
            "geometry": {
              "type": "Polygon",
              "coordinates": [
                [
                  [
                    -72.66752243041992,
                    -38.710428842148914
                  ],
                  [
                    -72.63713836669922,
                    -38.724492231683676
                  ],
                  [
                    -72.65190124511719,
                    -38.735740950821786
                  ],
                  [
                    -72.6522445678711,
                    -38.752209093775825
                  ],
                  [
                    -72.6606559753418,
                    -38.754351012062315
                  ],
                  [
                    -72.65962600708008,
                    -38.758634655815186
                  ],
                  [
                    -72.62615203857422,
                    -38.76157951175738
                  ],
                  [
                    -72.60469436645508,
                    -38.753146190934686
                  ],
                  [
                    -72.60005950927734,
                    -38.74765730401542
                  ],
                  [
                    -72.59387969970703,
                    -38.74698789869034
                  ],
                  [
                    -72.58941650390625,
                    -38.749665482332496
                  ],
                  [
                    -72.5782585144043,
                    -38.74685401687217
                  ],
                  [
                    -72.5592041015625,
                    -38.7348036252108
                  ],
                  [
                    -72.54632949829102,
                    -38.71163438396565
                  ],
                  [
                    -72.53070831298828,
                    -38.702525342335896
                  ],
                  [
                    -72.54770278930664,
                    -38.69622870885281
                  ],
                  [
                    -72.56589889526367,
                    -38.7120362267202
                  ],
                  [
                    -72.58409500122069,
                    -38.703998942455826
                  ],
                  [
                    -72.59834289550781,
                    -38.707213964583055
                  ],
                  [
                    -72.6028060913086,
                    -38.72288512722238
                  ],
                  [
                    -72.62048721313477,
                    -38.708017697527296
                  ],
                  [
                    -72.62409210205078,
                    -38.70493667217571
                  ],
                  [
                    -72.62872695922852,
                    -38.70989303926041
                  ],
                  [
                    -72.63559341430664,
                    -38.707481876568366
                  ],
                  [
                    -72.6500129699707,
                    -38.706946051593846
                  ],
                  [
                    -72.66597747802733,
                    -38.7054725122086
                  ],
                  [
                    -72.66752243041992,
                    -38.710428842148914
                  ]
                ]
              ]
            }
          }
        ];

        L.geoJSON(states, {}).addTo(map);
      }
    }
})();
